<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>NYC Motor Vehicle Collisions Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
html,body,#map{height:100%;margin:0}
h1{
    position:absolute;
    z-index:1000;
    top:12px;
    left:50%;
    transform:translateX(-50%);
    background:#fff;
    padding:6px 10px;
    border-radius:6px;
    font-family:system-ui,Arial;
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
    text-align:center;
}
</style>
</head>
<body>
<h1>NYC Motor Vehicle Collisions Map</h1>
  <div id="status">Loading…</div>
  <div id="map"></div>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const map = L.map('map').setView([40.7128,-74.0060], 11);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);
const csvUrl = 'https://raw.githubusercontent.com/farhanazam98/collisions-scrape/main/data/latest_collisions.csv';
function loadCsv() {
  const url = csvUrl + (csvUrl.includes('?') ? '&' : '?') + 'v=' + Date.now();
  Papa.parse(url,{download:true,header:true,dynamicTyping:true,skipEmptyLines:'greedy',complete:res=>{
    const rows = Array.isArray(res.data)?res.data:[];
    window.__rows = rows;
    const errCount = Array.isArray(res.errors)?res.errors.length:0;
    document.getElementById('status').textContent = 'Loaded ' + rows.length + ' rows' + (errCount?(' • ' + errCount + ' parse errors'):'');
  },error:err=>{
    document.getElementById('status').textContent = 'Error loading CSV';
    console.error(err);
  }});
}
loadCsv();
</script>
</body>
</html>
